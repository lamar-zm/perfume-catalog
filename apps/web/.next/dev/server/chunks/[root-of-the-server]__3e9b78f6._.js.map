{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/lamarkhalifa/projects/perfume-catalog/packages/database/src/db.ts"],"sourcesContent":["import Database from 'better-sqlite3';\nimport path from 'path';\nimport fs from 'fs';\nimport { fileURLToPath } from 'url';\n\n// Get the directory of this file (works in ESM)\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\n// Ensure data directory exists (relative to this package)\nconst dataDir = path.join(__dirname, '..', 'data');\nif (!fs.existsSync(dataDir)) {\n  fs.mkdirSync(dataDir, { recursive: true });\n}\n\nconst dbPath = path.join(dataDir, 'perfume-catalog.db');\nconst db: any = new Database(dbPath);\n\n// Enable foreign keys\ndb.pragma('foreign_keys = ON');\n\n// Initialize database schema\nexport function initializeDatabase() {\n  // Categories table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS categories (\n      id TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      slug TEXT UNIQUE NOT NULL,\n      description TEXT,\n      image TEXT,\n      created_at TEXT DEFAULT (datetime('now')),\n      updated_at TEXT DEFAULT (datetime('now'))\n    )\n  `);\n\n  // Brands table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS brands (\n      id TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      slug TEXT UNIQUE NOT NULL,\n      description TEXT,\n      image TEXT,\n      created_at TEXT DEFAULT (datetime('now')),\n      updated_at TEXT DEFAULT (datetime('now'))\n    )\n  `);\n\n  // Perfumes table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS perfumes (\n      id TEXT PRIMARY KEY,\n      title TEXT NOT NULL,\n      description TEXT,\n      price REAL NOT NULL,\n      discount REAL DEFAULT 0,\n      final_price REAL NOT NULL,\n      category_id TEXT,\n      brand_id TEXT,\n      notes TEXT DEFAULT '[]',\n      is_featured INTEGER DEFAULT 0,\n      sales_count INTEGER DEFAULT 0,\n      created_at TEXT DEFAULT (datetime('now')),\n      updated_at TEXT DEFAULT (datetime('now')),\n      FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL,\n      FOREIGN KEY (brand_id) REFERENCES brands(id) ON DELETE SET NULL\n    )\n  `);\n\n  // Perfume images table (multiple images per perfume)\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS perfume_images (\n      id TEXT PRIMARY KEY,\n      perfume_id TEXT NOT NULL,\n      url TEXT NOT NULL,\n      sort_order INTEGER DEFAULT 0,\n      FOREIGN KEY (perfume_id) REFERENCES perfumes(id) ON DELETE CASCADE\n    )\n  `);\n\n  // Admin table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS admins (\n      id TEXT PRIMARY KEY,\n      email TEXT UNIQUE NOT NULL,\n      password TEXT NOT NULL,\n      display_name TEXT,\n      role TEXT DEFAULT 'admin',\n      created_at TEXT DEFAULT (datetime('now'))\n    )\n  `);\n\n  // Create indexes for better performance\n  db.exec(`\n    CREATE INDEX IF NOT EXISTS idx_perfumes_category ON perfumes(category_id);\n    CREATE INDEX IF NOT EXISTS idx_perfumes_brand ON perfumes(brand_id);\n    CREATE INDEX IF NOT EXISTS idx_perfumes_sales ON perfumes(sales_count DESC);\n    CREATE INDEX IF NOT EXISTS idx_perfume_images_perfume ON perfume_images(perfume_id);\n  `);\n\n  // Migration: Add notes column if it doesn't exist\n  try {\n    db.exec(`ALTER TABLE perfumes ADD COLUMN notes TEXT DEFAULT '[]'`);\n    console.log('✅ Added notes column to perfumes table');\n  } catch (e) {\n    // Column already exists, ignore\n  }\n\n  // Migration: Add gender column if it doesn't exist\n  try {\n    db.exec(`ALTER TABLE perfumes ADD COLUMN gender TEXT DEFAULT 'unisex'`);\n    console.log('✅ Added gender column to perfumes table');\n  } catch (e) {\n    // Column already exists, ignore\n  }\n\n  // Migration: Add cover_image column if it doesn't exist\n  try {\n    db.exec(`ALTER TABLE perfumes ADD COLUMN cover_image TEXT DEFAULT ''`);\n    console.log('✅ Added cover_image column to perfumes table');\n  } catch (e) {\n    // Column already exists, ignore\n  }\n\n  // Migration: Add out_of_stock column if it doesn't exist\n  try {\n    db.exec(`ALTER TABLE perfumes ADD COLUMN out_of_stock INTEGER DEFAULT 0`);\n    console.log('✅ Added out_of_stock column to perfumes table');\n  } catch (e) {\n    // Column already exists, ignore\n  }\n\n  console.log('✅ Database initialized successfully');\n}\n\nexport default db;\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;;;;;;;;AAEA,gDAAgD;AAChD,MAAM,aAAa,IAAA,gHAAa,EAAC,8BAAY,GAAG;AAChD,MAAM,YAAY,4GAAI,CAAC,OAAO,CAAC;AAE/B,0DAA0D;AAC1D,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,WAAW,MAAM;AAC3C,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,UAAU;IAC3B,wGAAE,CAAC,SAAS,CAAC,SAAS;QAAE,WAAW;IAAK;AAC1C;AAEA,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,SAAS;AAClC,MAAM,KAAU,IAAI,8LAAQ,CAAC;AAE7B,sBAAsB;AACtB,GAAG,MAAM,CAAC;AAGH,SAAS;IACd,mBAAmB;IACnB,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;EAUT,CAAC;IAED,eAAe;IACf,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;EAUT,CAAC;IAED,iBAAiB;IACjB,GAAG,IAAI,CAAC,CAAC;;;;;;;;;;;;;;;;;;EAkBT,CAAC;IAED,qDAAqD;IACrD,GAAG,IAAI,CAAC,CAAC;;;;;;;;EAQT,CAAC;IAED,cAAc;IACd,GAAG,IAAI,CAAC,CAAC;;;;;;;;;EAST,CAAC;IAED,wCAAwC;IACxC,GAAG,IAAI,CAAC,CAAC;;;;;EAKT,CAAC;IAED,kDAAkD;IAClD,IAAI;QACF,GAAG,IAAI,CAAC,CAAC,uDAAuD,CAAC;QACjE,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,GAAG;IACV,gCAAgC;IAClC;IAEA,mDAAmD;IACnD,IAAI;QACF,GAAG,IAAI,CAAC,CAAC,4DAA4D,CAAC;QACtE,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,GAAG;IACV,gCAAgC;IAClC;IAEA,wDAAwD;IACxD,IAAI;QACF,GAAG,IAAI,CAAC,CAAC,2DAA2D,CAAC;QACrE,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,GAAG;IACV,gCAAgC;IAClC;IAEA,yDAAyD;IACzD,IAAI;QACF,GAAG,IAAI,CAAC,CAAC,8DAA8D,CAAC;QACxE,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,GAAG;IACV,gCAAgC;IAClC;IAEA,QAAQ,GAAG,CAAC;AACd;uCAEe"}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file:///Users/lamarkhalifa/projects/perfume-catalog/packages/database/src/services/categoryService.ts"],"sourcesContent":["import db from '../db';\nimport type { Category, PaginatedResult, PaginationParams } from '@perfume-catalog/shared';\n\n// Helper to convert DB row to Category\nfunction rowToCategory(row: any): Category {\n  return {\n    id: row.id,\n    name: row.name,\n    slug: row.slug,\n    description: row.description || '',\n    image: row.image || '',\n    createdAt: row.created_at,\n    updatedAt: row.updated_at,\n  };\n}\n\nexport const categoryService = {\n  getAll(): Category[] {\n    const rows = db.prepare('SELECT * FROM categories ORDER BY name').all();\n    return rows.map(rowToCategory);\n  },\n\n  getById(id: string): Category | null {\n    const row = db.prepare('SELECT * FROM categories WHERE id = ?').get(id);\n    return row ? rowToCategory(row) : null;\n  },\n\n  getBySlug(slug: string): Category | null {\n    const row = db.prepare('SELECT * FROM categories WHERE slug = ?').get(slug);\n    return row ? rowToCategory(row) : null;\n  },\n\n  getPaginated(params: PaginationParams): PaginatedResult<Category> {\n    const { page, pageSize } = params;\n    const offset = (page - 1) * pageSize;\n\n    const totalRow = db.prepare('SELECT COUNT(*) as count FROM categories').get() as { count: number };\n    const total = totalRow.count;\n    const totalPages = Math.ceil(total / pageSize);\n\n    const rows = db.prepare('SELECT * FROM categories ORDER BY name LIMIT ? OFFSET ?').all(pageSize, offset);\n\n    return {\n      data: rows.map(rowToCategory),\n      total,\n      page,\n      pageSize,\n      totalPages,\n    };\n  },\n\n  create(data: Omit<Category, 'id' | 'createdAt' | 'updatedAt'>): Category {\n    const id = `cat-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;\n    const now = new Date().toISOString();\n\n    db.prepare(`\n      INSERT INTO categories (id, name, slug, description, image, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?)\n    `).run(id, data.name, data.slug, data.description, data.image, now, now);\n\n    return this.getById(id)!;\n  },\n\n  update(id: string, data: Partial<Category>): Category | null {\n    const existing = this.getById(id);\n    if (!existing) return null;\n\n    const now = new Date().toISOString();\n    const updated = { ...existing, ...data, updatedAt: now };\n\n    db.prepare(`\n      UPDATE categories \n      SET name = ?, slug = ?, description = ?, image = ?, updated_at = ?\n      WHERE id = ?\n    `).run(updated.name, updated.slug, updated.description, updated.image, now, id);\n\n    return this.getById(id);\n  },\n\n  delete(id: string): boolean {\n    const result = db.prepare('DELETE FROM categories WHERE id = ?').run(id);\n    return result.changes > 0;\n  },\n};\n"],"names":[],"mappings":";;;;AAAA;;AAGA,uCAAuC;AACvC,SAAS,cAAc,GAAQ;IAC7B,OAAO;QACL,IAAI,IAAI,EAAE;QACV,MAAM,IAAI,IAAI;QACd,MAAM,IAAI,IAAI;QACd,aAAa,IAAI,WAAW,IAAI;QAChC,OAAO,IAAI,KAAK,IAAI;QACpB,WAAW,IAAI,UAAU;QACzB,WAAW,IAAI,UAAU;IAC3B;AACF;AAEO,MAAM,kBAAkB;IAC7B;QACE,MAAM,OAAO,8IAAE,CAAC,OAAO,CAAC,0CAA0C,GAAG;QACrE,OAAO,KAAK,GAAG,CAAC;IAClB;IAEA,SAAQ,EAAU;QAChB,MAAM,MAAM,8IAAE,CAAC,OAAO,CAAC,yCAAyC,GAAG,CAAC;QACpE,OAAO,MAAM,cAAc,OAAO;IACpC;IAEA,WAAU,IAAY;QACpB,MAAM,MAAM,8IAAE,CAAC,OAAO,CAAC,2CAA2C,GAAG,CAAC;QACtE,OAAO,MAAM,cAAc,OAAO;IACpC;IAEA,cAAa,MAAwB;QACnC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG;QAC3B,MAAM,SAAS,CAAC,OAAO,CAAC,IAAI;QAE5B,MAAM,WAAW,8IAAE,CAAC,OAAO,CAAC,4CAA4C,GAAG;QAC3E,MAAM,QAAQ,SAAS,KAAK;QAC5B,MAAM,aAAa,KAAK,IAAI,CAAC,QAAQ;QAErC,MAAM,OAAO,8IAAE,CAAC,OAAO,CAAC,2DAA2D,GAAG,CAAC,UAAU;QAEjG,OAAO;YACL,MAAM,KAAK,GAAG,CAAC;YACf;YACA;YACA;YACA;QACF;IACF;IAEA,QAAO,IAAsD;QAC3D,MAAM,KAAK,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,IAAI;QAC5E,MAAM,MAAM,IAAI,OAAO,WAAW;QAElC,8IAAE,CAAC,OAAO,CAAC,CAAC;;;IAGZ,CAAC,EAAE,GAAG,CAAC,IAAI,KAAK,IAAI,EAAE,KAAK,IAAI,EAAE,KAAK,WAAW,EAAE,KAAK,KAAK,EAAE,KAAK;QAEpE,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB;IAEA,QAAO,EAAU,EAAE,IAAuB;QACxC,MAAM,WAAW,IAAI,CAAC,OAAO,CAAC;QAC9B,IAAI,CAAC,UAAU,OAAO;QAEtB,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,UAAU;YAAE,GAAG,QAAQ;YAAE,GAAG,IAAI;YAAE,WAAW;QAAI;QAEvD,8IAAE,CAAC,OAAO,CAAC,CAAC;;;;IAIZ,CAAC,EAAE,GAAG,CAAC,QAAQ,IAAI,EAAE,QAAQ,IAAI,EAAE,QAAQ,WAAW,EAAE,QAAQ,KAAK,EAAE,KAAK;QAE5E,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB;IAEA,QAAO,EAAU;QACf,MAAM,SAAS,8IAAE,CAAC,OAAO,CAAC,uCAAuC,GAAG,CAAC;QACrE,OAAO,OAAO,OAAO,GAAG;IAC1B;AACF"}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":["file:///Users/lamarkhalifa/projects/perfume-catalog/packages/database/src/services/brandService.ts"],"sourcesContent":["import db from '../db';\nimport type { Brand, PaginatedResult, PaginationParams } from '@perfume-catalog/shared';\n\n// Helper to convert DB row to Brand\nfunction rowToBrand(row: any): Brand {\n  return {\n    id: row.id,\n    name: row.name,\n    slug: row.slug,\n    description: row.description || '',\n    image: row.image || '',\n    createdAt: row.created_at,\n    updatedAt: row.updated_at,\n  };\n}\n\nexport const brandService = {\n  getAll(): Brand[] {\n    const rows = db.prepare('SELECT * FROM brands ORDER BY name').all();\n    return rows.map(rowToBrand);\n  },\n\n  getById(id: string): Brand | null {\n    const row = db.prepare('SELECT * FROM brands WHERE id = ?').get(id);\n    return row ? rowToBrand(row) : null;\n  },\n\n  getBySlug(slug: string): Brand | null {\n    const row = db.prepare('SELECT * FROM brands WHERE slug = ?').get(slug);\n    return row ? rowToBrand(row) : null;\n  },\n\n  getPaginated(params: PaginationParams): PaginatedResult<Brand> {\n    const { page, pageSize } = params;\n    const offset = (page - 1) * pageSize;\n\n    const totalRow = db.prepare('SELECT COUNT(*) as count FROM brands').get() as { count: number };\n    const total = totalRow.count;\n    const totalPages = Math.ceil(total / pageSize);\n\n    const rows = db.prepare('SELECT * FROM brands ORDER BY name LIMIT ? OFFSET ?').all(pageSize, offset);\n\n    return {\n      data: rows.map(rowToBrand),\n      total,\n      page,\n      pageSize,\n      totalPages,\n    };\n  },\n\n  create(data: Omit<Brand, 'id' | 'createdAt' | 'updatedAt'>): Brand {\n    const id = `brand-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;\n    const now = new Date().toISOString();\n\n    db.prepare(`\n      INSERT INTO brands (id, name, slug, description, image, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?)\n    `).run(id, data.name, data.slug, data.description, data.image, now, now);\n\n    return this.getById(id)!;\n  },\n\n  update(id: string, data: Partial<Brand>): Brand | null {\n    const existing = this.getById(id);\n    if (!existing) return null;\n\n    const now = new Date().toISOString();\n    const updated = { ...existing, ...data, updatedAt: now };\n\n    db.prepare(`\n      UPDATE brands \n      SET name = ?, slug = ?, description = ?, image = ?, updated_at = ?\n      WHERE id = ?\n    `).run(updated.name, updated.slug, updated.description, updated.image, now, id);\n\n    return this.getById(id);\n  },\n\n  delete(id: string): boolean {\n    const result = db.prepare('DELETE FROM brands WHERE id = ?').run(id);\n    return result.changes > 0;\n  },\n};\n"],"names":[],"mappings":";;;;AAAA;;AAGA,oCAAoC;AACpC,SAAS,WAAW,GAAQ;IAC1B,OAAO;QACL,IAAI,IAAI,EAAE;QACV,MAAM,IAAI,IAAI;QACd,MAAM,IAAI,IAAI;QACd,aAAa,IAAI,WAAW,IAAI;QAChC,OAAO,IAAI,KAAK,IAAI;QACpB,WAAW,IAAI,UAAU;QACzB,WAAW,IAAI,UAAU;IAC3B;AACF;AAEO,MAAM,eAAe;IAC1B;QACE,MAAM,OAAO,8IAAE,CAAC,OAAO,CAAC,sCAAsC,GAAG;QACjE,OAAO,KAAK,GAAG,CAAC;IAClB;IAEA,SAAQ,EAAU;QAChB,MAAM,MAAM,8IAAE,CAAC,OAAO,CAAC,qCAAqC,GAAG,CAAC;QAChE,OAAO,MAAM,WAAW,OAAO;IACjC;IAEA,WAAU,IAAY;QACpB,MAAM,MAAM,8IAAE,CAAC,OAAO,CAAC,uCAAuC,GAAG,CAAC;QAClE,OAAO,MAAM,WAAW,OAAO;IACjC;IAEA,cAAa,MAAwB;QACnC,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG;QAC3B,MAAM,SAAS,CAAC,OAAO,CAAC,IAAI;QAE5B,MAAM,WAAW,8IAAE,CAAC,OAAO,CAAC,wCAAwC,GAAG;QACvE,MAAM,QAAQ,SAAS,KAAK;QAC5B,MAAM,aAAa,KAAK,IAAI,CAAC,QAAQ;QAErC,MAAM,OAAO,8IAAE,CAAC,OAAO,CAAC,uDAAuD,GAAG,CAAC,UAAU;QAE7F,OAAO;YACL,MAAM,KAAK,GAAG,CAAC;YACf;YACA;YACA;YACA;QACF;IACF;IAEA,QAAO,IAAmD;QACxD,MAAM,KAAK,CAAC,MAAM,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,IAAI;QAC9E,MAAM,MAAM,IAAI,OAAO,WAAW;QAElC,8IAAE,CAAC,OAAO,CAAC,CAAC;;;IAGZ,CAAC,EAAE,GAAG,CAAC,IAAI,KAAK,IAAI,EAAE,KAAK,IAAI,EAAE,KAAK,WAAW,EAAE,KAAK,KAAK,EAAE,KAAK;QAEpE,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB;IAEA,QAAO,EAAU,EAAE,IAAoB;QACrC,MAAM,WAAW,IAAI,CAAC,OAAO,CAAC;QAC9B,IAAI,CAAC,UAAU,OAAO;QAEtB,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,UAAU;YAAE,GAAG,QAAQ;YAAE,GAAG,IAAI;YAAE,WAAW;QAAI;QAEvD,8IAAE,CAAC,OAAO,CAAC,CAAC;;;;IAIZ,CAAC,EAAE,GAAG,CAAC,QAAQ,IAAI,EAAE,QAAQ,IAAI,EAAE,QAAQ,WAAW,EAAE,QAAQ,KAAK,EAAE,KAAK;QAE5E,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB;IAEA,QAAO,EAAU;QACf,MAAM,SAAS,8IAAE,CAAC,OAAO,CAAC,mCAAmC,GAAG,CAAC;QACjE,OAAO,OAAO,OAAO,GAAG;IAC1B;AACF"}},
    {"offset": {"line": 365, "column": 0}, "map": {"version":3,"sources":["file:///Users/lamarkhalifa/projects/perfume-catalog/packages/database/src/services/perfumeService.ts"],"sourcesContent":["import db from '../db';\nimport type { Perfume, PaginatedResult, PaginationParams, PerfumeFilters, SortOptions } from '@perfume-catalog/shared';\n\n// Helper to get images for a perfume\nfunction getPerfumeImages(perfumeId: string): string[] {\n  const rows = db.prepare(\n    'SELECT url FROM perfume_images WHERE perfume_id = ? ORDER BY sort_order'\n  ).all(perfumeId) as { url: string }[];\n  return rows.map((r) => r.url);\n}\n\n// Helper to convert DB row to Perfume\nfunction rowToPerfume(row: any): Perfume {\n  // Parse notes from JSON string\n  let notes: string[] = [];\n  try {\n    notes = JSON.parse(row.notes || '[]');\n  } catch {\n    notes = [];\n  }\n\n  return {\n    id: row.id,\n    title: row.title,\n    description: row.description || '',\n    price: row.price,\n    discount: row.discount || 0,\n    gender: row.gender || 'unisex',\n    coverImage: row.cover_image || '',\n    outOfStock: row.out_of_stock === 1,\n    finalPrice: row.final_price,\n    categoryId: row.category_id || '',\n    brandId: row.brand_id || '',\n    images: getPerfumeImages(row.id),\n    notes,\n    // isFeatured: row.is_featured === 1, // Removed to match Perfume type\n    salesCount: row.sales_count || 0,\n    createdAt: row.created_at,\n    updatedAt: row.updated_at,\n  };\n}\n\n// Helper to save perfume images\nfunction savePerfumeImages(perfumeId: string, images: string[]) {\n  // Delete existing images\n  db.prepare('DELETE FROM perfume_images WHERE perfume_id = ?').run(perfumeId);\n  \n  // Insert new images\n  const insertStmt = db.prepare(`\n    INSERT INTO perfume_images (id, perfume_id, url, sort_order) VALUES (?, ?, ?, ?)\n  `);\n  \n  images.forEach((url, index) => {\n    insertStmt.run(`img-${perfumeId}-${index}`, perfumeId, url, index);\n  });\n}\n\nexport const perfumeService = {\n  getAll(\n    params: PaginationParams,\n    filters?: PerfumeFilters,\n    sort?: SortOptions\n  ): PaginatedResult<Perfume> {\n    const { page, pageSize } = params;\n    const offset = (page - 1) * pageSize;\n\n    let whereClause = 'WHERE 1=1';\n    const queryParams: any[] = [];\n\n    if (filters?.categoryId) {\n      whereClause += ' AND category_id = ?';\n      queryParams.push(filters.categoryId);\n    }\n\n    if (filters?.brandId) {\n      whereClause += ' AND brand_id = ?';\n      queryParams.push(filters.brandId);\n    }\n\n    // if (filters?.isFeatured !== undefined) {\n    //   whereClause += ' AND is_featured = ?';\n    //   queryParams.push(filters.isFeatured ? 1 : 0);\n    // }\n\n    if (filters?.hasDiscount) {\n      whereClause += ' AND discount > 0';\n    }\n\n    if (filters?.search) {\n      whereClause += ' AND (title LIKE ? OR description LIKE ?)';\n      const searchTerm = `%${filters.search}%`;\n      queryParams.push(searchTerm, searchTerm);\n    }\n\n    // Get total count\n    const totalRow = db.prepare(`SELECT COUNT(*) as count FROM perfumes ${whereClause}`).get(...queryParams) as { count: number };\n    const total = totalRow.count;\n    const totalPages = Math.ceil(total / pageSize);\n\n    // Build sort clause\n    let orderClause = 'ORDER BY created_at DESC';\n    if (sort) {\n      const fieldMap: Record<string, string> = {\n        price: 'price',\n        salesCount: 'sales_count',\n        createdAt: 'created_at',\n        title: 'title',\n      };\n      const dbField = fieldMap[sort.field] || 'created_at';\n      orderClause = `ORDER BY ${dbField} ${sort.direction.toUpperCase()}`;\n    }\n\n    const rows = db.prepare(\n      `SELECT * FROM perfumes ${whereClause} ${orderClause} LIMIT ? OFFSET ?`\n    ).all(...queryParams, pageSize, offset);\n\n    return {\n      data: rows.map(rowToPerfume),\n      total,\n      page,\n      pageSize,\n      totalPages,\n    };\n  },\n\n  getById(id: string): Perfume | null {\n    const row = db.prepare('SELECT * FROM perfumes WHERE id = ?').get(id);\n    return row ? rowToPerfume(row) : null;\n  },\n\n  getMostSold(limit: number = 8): Perfume[] {\n    const rows = db.prepare(\n      'SELECT * FROM perfumes ORDER BY sales_count DESC LIMIT ?'\n    ).all(limit);\n    return rows.map(rowToPerfume);\n  },\n\n  getFeatured(limit: number = 8): Perfume[] {\n    const rows = db.prepare(\n      'SELECT * FROM perfumes WHERE is_featured = 1 LIMIT ?'\n    ).all(limit);\n    return rows.map(rowToPerfume);\n  },\n\n  getDiscounted(limit?: number): Perfume[] {\n    const query = limit\n      ? 'SELECT * FROM perfumes WHERE discount > 0 ORDER BY discount DESC LIMIT ?'\n      : 'SELECT * FROM perfumes WHERE discount > 0 ORDER BY discount DESC';\n    const rows = limit ? db.prepare(query).all(limit) : db.prepare(query).all();\n    return rows.map(rowToPerfume);\n  },\n\n  getByCategory(categoryId: string, params: PaginationParams): PaginatedResult<Perfume> {\n    return this.getAll(params, { categoryId });\n  },\n\n  getByBrand(brandId: string, params: PaginationParams): PaginatedResult<Perfume> {\n    return this.getAll(params, { brandId });\n  },\n\n  getRelated(perfumeId: string, categoryId: string, limit: number = 4): Perfume[] {\n    const rows = db.prepare(\n      'SELECT * FROM perfumes WHERE category_id = ? AND id != ? LIMIT ?'\n    ).all(categoryId, perfumeId, limit);\n    return rows.map(rowToPerfume);\n  },\n\n  create(data: Omit<Perfume, 'id' | 'createdAt' | 'updatedAt' | 'finalPrice'>): Perfume {\n    const id = `perf-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;\n    const now = new Date().toISOString();\n    const finalPrice = data.price - (data.discount || 0);\n    const notesJson = JSON.stringify(data.notes || []);\n\n    db.prepare(`\n      INSERT INTO perfumes (id, title, description, price, discount, final_price, category_id, brand_id, gender, cover_image, notes, out_of_stock, sales_count, created_at, updated_at)\n      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `).run(\n      id, \n      data.title, \n      data.description, \n      data.price, \n      data.discount || 0, \n      finalPrice,\n      data.categoryId || null, \n      data.brandId || null, \n      (data as any).gender || 'unisex',\n      (data as any).coverImage || '',\n      notesJson,\n      (data as any).outOfStock ? 1 : 0,\n      data.salesCount || 0,\n      now, \n      now\n    );\n\n    // Save images\n    if (data.images && data.images.length > 0) {\n      savePerfumeImages(id, data.images);\n    }\n\n    return this.getById(id)!;\n  },\n\n  update(id: string, data: Partial<Perfume>): Perfume | null {\n    const existing = this.getById(id);\n    if (!existing) return null;\n\n    const now = new Date().toISOString();\n    const price = data.price ?? existing.price;\n    const discount = data.discount ?? existing.discount;\n    const finalPrice = price - discount;\n    const notesJson = JSON.stringify(data.notes ?? existing.notes);\n\n    db.prepare(`\n      UPDATE perfumes \n      SET title = ?, description = ?, price = ?, discount = ?, final_price = ?, \n          category_id = ?, brand_id = ?, gender = ?, cover_image = ?, notes = ?, out_of_stock = ?, sales_count = ?, updated_at = ?\n      WHERE id = ?\n    `).run(\n      data.title ?? existing.title,\n      data.description ?? existing.description,\n      price,\n      discount,\n      finalPrice,\n      (data.categoryId ?? existing.categoryId) || null,\n      (data.brandId ?? existing.brandId) || null,\n      (data as any).gender ?? (existing as any).gender ?? 'unisex',\n      (data as any).coverImage ?? (existing as any).coverImage ?? '',\n      notesJson,\n      (data as any).outOfStock ? 1 : 0,\n      data.salesCount ?? existing.salesCount,\n      now,\n      id\n    );\n\n    // Update images if provided\n    if (data.images) {\n      savePerfumeImages(id, data.images);\n    }\n\n    return this.getById(id);\n  },\n\n  updateDiscount(id: string, discount: number): Perfume | null {\n    const existing = this.getById(id);\n    if (!existing) return null;\n\n    const finalPrice = existing.price - discount;\n    const now = new Date().toISOString();\n\n    db.prepare(`\n      UPDATE perfumes SET discount = ?, final_price = ?, updated_at = ? WHERE id = ?\n    `).run(discount, finalPrice, now, id);\n\n    return this.getById(id);\n  },\n\n  // toggleFeatured(id: string): Perfume | null {\n  //   const existing = this.getById(id);\n  //   if (!existing) return null;\n\n  //   const now = new Date().toISOString();\n  //   // const newFeatured = existing.isFeatured ? 0 : 1;\n\n  //   db.prepare(`\n  //     UPDATE perfumes SET is_featured = ?, updated_at = ? WHERE id = ?\n  //   `).run(newFeatured, now, id);\n\n  //   return this.getById(id);\n  // },\n\n  delete(id: string): boolean {\n    // Images will be deleted by CASCADE\n    const result = db.prepare('DELETE FROM perfumes WHERE id = ?').run(id);\n    return result.changes > 0;\n  },\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 570, "column": 0}, "map": {"version":3,"sources":["file:///Users/lamarkhalifa/projects/perfume-catalog/packages/database/src/services/authService.ts"],"sourcesContent":["import bcrypt from 'bcryptjs';\nimport db from '../db';\nimport type { Admin, AuthResponse, LoginCredentials } from '@perfume-catalog/shared';\n\n// Helper to convert DB row to Admin\nfunction rowToAdmin(row: any): Admin {\n  return {\n    id: row.id,\n    email: row.email,\n    displayName: row.display_name || 'مدير النظام',\n    role: row.role || 'admin',\n    createdAt: row.created_at,\n  };\n}\n\nexport const authService = {\n  async signIn(credentials: LoginCredentials): Promise<AuthResponse> {\n    const { email, password } = credentials;\n\n    const row = db.prepare('SELECT * FROM admins WHERE email = ?').get(email) as any;\n    \n    if (!row) {\n      return {\n        success: false,\n        error: 'البريد الإلكتروني أو كلمة المرور غير صحيحة',\n      };\n    }\n\n    const isValid = await bcrypt.compare(password, row.password);\n    \n    if (!isValid) {\n      return {\n        success: false,\n        error: 'البريد الإلكتروني أو كلمة المرور غير صحيحة',\n      };\n    }\n\n    const admin = rowToAdmin(row);\n    \n    // Generate a simple token (in production, use JWT)\n    const token = Buffer.from(`${admin.id}:${Date.now()}`).toString('base64');\n\n    return {\n      success: true,\n      user: admin,\n      token,\n    };\n  },\n\n  getById(id: string): Admin | null {\n    const row = db.prepare('SELECT * FROM admins WHERE id = ?').get(id);\n    return row ? rowToAdmin(row) : null;\n  },\n\n  getByEmail(email: string): Admin | null {\n    const row = db.prepare('SELECT * FROM admins WHERE email = ?').get(email);\n    return row ? rowToAdmin(row) : null;\n  },\n\n  async createAdmin(email: string, password: string, displayName: string = 'مدير النظام', role: 'admin' | 'superadmin' = 'admin'): Promise<Admin> {\n    const id = `admin-${Date.now()}`;\n    const now = new Date().toISOString();\n    const hashedPassword = await bcrypt.hash(password, 10);\n\n    db.prepare(`\n      INSERT INTO admins (id, email, password, display_name, role, created_at)\n      VALUES (?, ?, ?, ?, ?, ?)\n    `).run(id, email, hashedPassword, displayName, role, now);\n\n    return this.getById(id)!;\n  },\n\n  validateToken(token: string): Admin | null {\n    try {\n      const decoded = Buffer.from(token, 'base64').toString('utf-8');\n      const [adminId] = decoded.split(':');\n      return this.getById(adminId);\n    } catch {\n      return null;\n    }\n  },\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGA,oCAAoC;AACpC,SAAS,WAAW,GAAQ;IAC1B,OAAO;QACL,IAAI,IAAI,EAAE;QACV,OAAO,IAAI,KAAK;QAChB,aAAa,IAAI,YAAY,IAAI;QACjC,MAAM,IAAI,IAAI,IAAI;QAClB,WAAW,IAAI,UAAU;IAC3B;AACF;AAEO,MAAM,cAAc;IACzB,MAAM,QAAO,WAA6B;QACxC,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAE5B,MAAM,MAAM,8IAAE,CAAC,OAAO,CAAC,wCAAwC,GAAG,CAAC;QAEnE,IAAI,CAAC,KAAK;YACR,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,IAAI,QAAQ;QAE3D,IAAI,CAAC,SAAS;YACZ,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,MAAM,QAAQ,WAAW;QAEzB,mDAAmD;QACnD,MAAM,QAAQ,OAAO,IAAI,CAAC,GAAG,MAAM,EAAE,CAAC,CAAC,EAAE,KAAK,GAAG,IAAI,EAAE,QAAQ,CAAC;QAEhE,OAAO;YACL,SAAS;YACT,MAAM;YACN;QACF;IACF;IAEA,SAAQ,EAAU;QAChB,MAAM,MAAM,8IAAE,CAAC,OAAO,CAAC,qCAAqC,GAAG,CAAC;QAChE,OAAO,MAAM,WAAW,OAAO;IACjC;IAEA,YAAW,KAAa;QACtB,MAAM,MAAM,8IAAE,CAAC,OAAO,CAAC,wCAAwC,GAAG,CAAC;QACnE,OAAO,MAAM,WAAW,OAAO;IACjC;IAEA,MAAM,aAAY,KAAa,EAAE,QAAgB,EAAE,cAAsB,aAAa,EAAE,OAA+B,OAAO;QAC5H,MAAM,KAAK,CAAC,MAAM,EAAE,KAAK,GAAG,IAAI;QAChC,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,iBAAiB,MAAM,8IAAM,CAAC,IAAI,CAAC,UAAU;QAEnD,8IAAE,CAAC,OAAO,CAAC,CAAC;;;IAGZ,CAAC,EAAE,GAAG,CAAC,IAAI,OAAO,gBAAgB,aAAa,MAAM;QAErD,OAAO,IAAI,CAAC,OAAO,CAAC;IACtB;IAEA,eAAc,KAAa;QACzB,IAAI;YACF,MAAM,UAAU,OAAO,IAAI,CAAC,OAAO,UAAU,QAAQ,CAAC;YACtD,MAAM,CAAC,QAAQ,GAAG,QAAQ,KAAK,CAAC;YAChC,OAAO,IAAI,CAAC,OAAO,CAAC;QACtB,EAAE,OAAM;YACN,OAAO;QACT;IACF;AACF"}},
    {"offset": {"line": 646, "column": 0}, "map": {"version":3,"sources":["file:///Users/lamarkhalifa/projects/perfume-catalog/packages/database/src/index.ts"],"sourcesContent":["import db, { initializeDatabase } from './db';\ninitializeDatabase();\nexport { db, initializeDatabase };\nexport { categoryService } from './services/categoryService';\nexport { brandService } from './services/brandService';\nexport { perfumeService } from './services/perfumeService';\nexport { authService } from './services/authService';\n\n// Re-export types for convenience\nexport type {\n  Perfume,\n  Category,\n  Brand,\n  Admin,\n  PaginatedResult,\n  PaginationParams,\n  PerfumeFilters,\n  SortOptions,\n  ApiResponse,\n  AuthResponse,\n  LoginCredentials,\n} from '@perfume-catalog/shared';\n"],"names":[],"mappings":";AAAA;AAGA;AACA;AACA;AACA;;AALA,IAAA,yJAAkB"}},
    {"offset": {"line": 663, "column": 0}, "map": {"version":3,"sources":["file:///Users/lamarkhalifa/projects/perfume-catalog/apps/web/src/app/api/brands/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { brandService } from '@perfume-catalog/database';\nimport type { ApiResponse, Brand, PaginatedResult } from '@perfume-catalog/shared';\n\n// GET /api/brands - Get all brands\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const paginated = searchParams.get('paginated') === 'true';\n    \n    if (paginated) {\n      const page = parseInt(searchParams.get('page') || '1');\n      const pageSize = parseInt(searchParams.get('pageSize') || '10');\n      const result = brandService.getPaginated({ page, pageSize });\n      \n      return NextResponse.json<ApiResponse<PaginatedResult<Brand>>>({\n        success: true,\n        data: result,\n      });\n    }\n\n    const brands = brandService.getAll();\n    return NextResponse.json<ApiResponse<Brand[]>>({\n      success: true,\n      data: brands,\n    });\n  } catch (error) {\n    console.error('Error fetching brands:', error);\n    return NextResponse.json<ApiResponse<never>>(\n      { success: false, error: 'فشل تحميل الماركات' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST /api/brands - Create a new brand\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    \n    // Validate required fields\n    if (!body.name || !body.slug) {\n      return NextResponse.json<ApiResponse<never>>(\n        { success: false, error: 'الاسم والرابط مطلوبان' },\n        { status: 400 }\n      );\n    }\n\n    // Check if slug already exists\n    const existing = brandService.getBySlug(body.slug);\n    if (existing) {\n      return NextResponse.json<ApiResponse<never>>(\n        { success: false, error: 'الرابط موجود مسبقاً' },\n        { status: 400 }\n      );\n    }\n\n    const brand = brandService.create({\n      name: body.name,\n      slug: body.slug,\n      description: body.description || '',\n      image: body.image || '',\n    });\n\n    return NextResponse.json<ApiResponse<Brand>>({\n      success: true,\n      data: brand,\n      message: 'تم إضافة الماركة بنجاح',\n    });\n  } catch (error) {\n    console.error('Error creating brand:', error);\n    return NextResponse.json<ApiResponse<never>>(\n      { success: false, error: 'فشل إضافة الماركة' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;AAIO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,YAAY,aAAa,GAAG,CAAC,iBAAiB;QAEpD,IAAI,WAAW;YACb,MAAM,OAAO,SAAS,aAAa,GAAG,CAAC,WAAW;YAClD,MAAM,WAAW,SAAS,aAAa,GAAG,CAAC,eAAe;YAC1D,MAAM,SAAS,yKAAY,CAAC,YAAY,CAAC;gBAAE;gBAAM;YAAS;YAE1D,OAAO,gJAAY,CAAC,IAAI,CAAsC;gBAC5D,SAAS;gBACT,MAAM;YACR;QACF;QAEA,MAAM,SAAS,yKAAY,CAAC,MAAM;QAClC,OAAO,gJAAY,CAAC,IAAI,CAAuB;YAC7C,SAAS;YACT,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAqB,GAC9C;YAAE,QAAQ;QAAI;IAElB;AACF;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,2BAA2B;QAC3B,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,IAAI,EAAE;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAwB,GACjD;gBAAE,QAAQ;YAAI;QAElB;QAEA,+BAA+B;QAC/B,MAAM,WAAW,yKAAY,CAAC,SAAS,CAAC,KAAK,IAAI;QACjD,IAAI,UAAU;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAsB,GAC/C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,yKAAY,CAAC,MAAM,CAAC;YAChC,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;YACf,aAAa,KAAK,WAAW,IAAI;YACjC,OAAO,KAAK,KAAK,IAAI;QACvB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAqB;YAC3C,SAAS;YACT,MAAM;YACN,SAAS;QACX;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAoB,GAC7C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}